  // Compute ustar
scalar TZRef_(ABLDict.lookupOrDefault<scalar>("TZRef",2.0));
scalar Czil_=Foam::pow(10,-kappa_*Z0_/0.07);
scalar zt_=Z0_*Foam::exp(-kappa_*Czil_*Foam::sqrt(ustar*Z0_/1e-5));
scalar thetastar=TRef*Foam::sqr(ustar)/(kappa_*9.81*MOL);
scalar x=Foam::pow(1- Foam::neg(MOL)*16*(TZRef_)/MOL,0.25);
scalar psiHL= (MOL<0)? (2*Foam::log(0.5*(1+Foam::sqr(x)))): (-5.0*TZRef_/MOL);
TZRef_=TZRef_+zt_;
scalar Twall_= TRef - thetastar/kappa_*(Foam::log(TZRef_/zt_)-psiHL);
//Info<<"TRef:"<<TRef<<" ustar:"<<ustar<<" thetastar:"<<thetastar<<"  "<<psiHL<<"  "<<TZRef_<<"  "<<zt_<<endl;
//scalar cellesat=610.94*Foam::exp(17.625*(TRef-273.15)/(TRef-30.11));
//scalar cellqsat=(0.622 *cellesat/(101325-0.378*cellesat));
scalar faceesat=610.94*Foam::exp(17.625*(Twall_-273.15)/(Twall_-30.11));
scalar faceqsat=(0.622 *faceesat/(101325-0.378*faceesat));
scalar qvCell=RH;                                                                         
scalar qvFace=faceqsat;
x=Foam::pow(1- Foam::neg(MOL)*16*(TZRef_)/MOL,0.25);                                        
psiHL= (MOL<0)? (2*Foam::log(0.5*(1+Foam::sqr(x)))): (-5.0*TZRef_/MOL);
scalar ka=2.4e-5;
  scalar den=Foam::log(kappa_*ustar*TZRef_/ka+TZRef_/0.01)-psiHL;
//scalar qstar=(qvCell-qvFace)*kappa_/(Foam::log(TZRef_/zt_)-psiHL); 
//scalar den=Foam::log(TZRef_/zt_)-psiHL;
scalar qstar=mAvail_*kappa_/den*(qvCell-qvFace);
scalar qwall_= qvCell - qstar/kappa_*(Foam::log(TZRef_/zt_)-psiHL);
Info<<"TRef:"<<TRef<<" ustar:"<<ustar<<" thetastar:"<<thetastar<<"  "<<psiHL<<"  "<<TZRef_<<"  "<<zt_<<endl;
